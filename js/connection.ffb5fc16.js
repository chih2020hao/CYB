(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["connection"],{"6fcd":function(e,t,s){},"86df":function(e,t,s){"use strict";s("6fcd")},a86f:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"connection"}},[s("b-container",{staticClass:"vh-100 mt-6"},[s("br"),s("h2",{staticClass:"text-white mt-3 h2"},[e._v("留言板")]),s("b-row",e._l(e.messages,(function(t,a){return s("b-col",{key:t._id,staticClass:"max-height my-5",attrs:{cols:"12",lg:"4"}},[s("b-card",{attrs:{"no-body":""}},[s("b-card-header",{staticClass:"d-flex justify-content-end"},[s("font-awesome-icon",{staticClass:"mb-1",attrs:{icon:["far","user-circle"],size:"lg"}}),s("h4",{staticClass:"flex-fill ml-1"},[e._v(e._s(t.user))]),"root"===e.user.gender?s("b-dropdown",{attrs:{text:"管理留言",size:"sm",variant:"wihte"}},[s("b-dropdown-item",{on:{click:function(s){return e.muteUser(t.userId)}}},[e._v("禁言此會員")]),s("b-dropdown-item",{on:{click:function(s){return e.deleteMessage(t._id)}}},[e._v("刪除此留言")])],1):e._e()],1),s("b-card-body",{staticClass:"pt-2"},[s("b-card-text",{staticClass:"mb-5"},[e._v(e._s(t.message))]),t.replyed?s("font-awesome-icon",{staticClass:"ml-3",attrs:{icon:["fas","user-cog"]}}):e._e(),t.replyed?s("p",{staticClass:"ml-1 d-inline"},[e._v("管理員")]):e._e(),t.replyed?s("p",{staticClass:"ml-3"},[e._v(e._s(t.reply))]):e._e(),t.replyed&&"root"===e.user.gender?s("b-button",{attrs:{variant:"danger",size:"sm"},on:{click:function(s){return e.deleteReply(t._id,a)}}},[e._v("刪除回覆")]):e._e()],1),"root"!==e.user.gender||t.replyed?e._e():s("b-card-footer",[s("b-form",{on:{submit:function(s){return e.onSubmit(t._id,a)},reset:function(t){return e.reset()}}},[s("b-textarea",{attrs:{rows:"3",cols:"10"},model:{value:e.reply[a],callback:function(t){e.$set(e.reply,a,t)},expression:"reply[index]"}},[e._v(e._s(t._id))]),s("b-button",{staticClass:"m-btn mt-2",attrs:{type:"submit",variant:"primary"}},[e._v("送出")]),s("b-button",{staticClass:"mt-2 ml-2",attrs:{type:"reset"}},[e._v("重置")])],1)],1)],1)],1)})),1),"root"!==e.user.gender?s("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.message",modifiers:{message:!0}}],staticClass:"fixed-top text-white position",attrs:{pill:"",variant:"info"}},[e._v("我要留言")]):e._e(),s("b-modal",{attrs:{id:"message"},scopedSlots:e._u([{key:"modal-header",fn:function(t){var a=t.close;return[s("h3",[e._v("留言")]),s("b-button",{attrs:{variant:"light"},on:{click:function(e){return a()}}},[s("font-awesome-icon",{attrs:{icon:["far","times-circle"]}})],1)]}},{key:"default",fn:function(t){t.hide;return[s("b-form",{on:{submit:function(t){return e.sendMessage()}}},[s("b-textarea",{staticClass:"mb-2",attrs:{rows:"5"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),s("div",{staticClass:"d-flex justify-content-end mt-4"},[s("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("送出")]),s("b-button",{staticClass:"ml-2",attrs:{type:"reset"}},[e._v("清除")])],1)],1)]}},{key:"modal-footer",fn:function(e){e.ok,e.cancel,e.hide;return[s("h6",{staticClass:"mr-auto"})]}}])})],1)],1)},n=[],r=(s("d81d"),{name:"Connection",data:function(){return{messages:[],reply:[],message:""}},computed:{user:function(){return this.$store.state.user}},methods:{onSubmit:function(e,t){var s=this,a={};a[0]=this.messages[t],delete a[0]._id,delete a[0].replyed,a[0].reply=this.reply[t],this.axios.patch("https://cyb-backstage.herokuapp.com/message/reply/"+e,a[0]).then((function(e){e.data.success?(s.messages[t].replyed=!0,s.reply="",location.reload()):s.$swal({icon:"error",title:"發生錯誤",text:e.data.message})})).catch((function(e){s.$swal({icon:"error",title:"發生錯誤",text:e.response.data.message})}))},reset:function(){this.reply=""},deleteMessage:function(e){var t=this;this.axios.delete("https://cyb-backstage.herokuapp.com/message/"+e).then((function(e){e.data.success&&location.reload()})).catch((function(e){console.log(e),t.$swal({icon:"error",title:"發生錯誤",text:e.response.data.message})}))},muteUser:function(e){var t=this;this.axios.patch("https://cyb-backstage.herokuapp.com/users/"+e,{messageAble:!1}).then((function(e){e.data.success&&location.reload()})).catch((function(e){t.$swal({icon:"error",title:"發生錯誤",text:e.response.data.message})}))},sendMessage:function(){var e=this,t={message:this.message};this.axios.post("https://cyb-backstage.herokuapp.com/message/",t).then((function(t){t.data.success&&(e.$swal({icon:"success",title:"成功",text:"留言完成"}),location.reload())})).catch((function(t){e.$swal({icon:"error",title:"發生錯誤",text:t.response.data.message})}))},deleteReply:function(e,t){var s=this,a={};a[0]=this.messages[t],delete a[0]._id,delete a[0].replyed,a[0].reply="",this.axios.patch("https://cyb-backstage.herokuapp.com/message/reply/"+e,a[0]).then((function(e){e.data.success?(s.messages[t].replyed=!0,s.reply="",location.reload()):s.$swal({icon:"error",title:"發生錯誤",text:e.data.message})})).catch((function(e){s.$swal({icon:"error",title:"發生錯誤",text:e.response.data.message})}))}},mounted:function(){var e=this;this.axios.get("https://cyb-backstage.herokuapp.com/message/messages").then((function(t){t.data.success&&(e.messages=t.data.result,e.messages.map((function(e){e.reply=e.reply||"",void 0===e.reply||0===e.reply.length?e.replyed=!1:e.replyed=!0})))})).catch((function(t){console.log(t),e.$swal({icon:"error",title:"錯誤",text:t.response.data.message})}))}}),o=r,i=(s("86df"),s("2877")),c=Object(i["a"])(o,a,n,!1,null,null,null);t["default"]=c.exports}}]);
//# sourceMappingURL=connection.ffb5fc16.js.map