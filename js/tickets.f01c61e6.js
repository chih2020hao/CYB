(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["tickets"],{"1d7f":function(t,s,e){},b7fc:function(t,s,e){"use strict";e("1d7f")},d464:function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"mt-6",attrs:{id:"tickets"}},[e("b-container",[e("b-row",[e("b-col",{staticClass:"bg-light mt-3 rounded-lg mx-auto",attrs:{cols:"10"}},[e("h1",{staticClass:"my-3"},[t._v("訂票")]),e("b-form",{staticClass:"mx-5 my-3",on:{submit:t.onSubmit,reset:t.onReset}},[e("b-form-group",{attrs:{label:"場次","label-for":"title"}},[e("b-form-select",{attrs:{id:"title"},model:{value:t.selected,callback:function(s){t.selected=s},expression:"selected"}},t._l(t.options,(function(s){return e("b-form-select-option",{attrs:{value:s.value}},[t._v(t._s(s.text))])})),1)],1),e("p",[t._v("剩餘座位數: "+t._s(t.selected.seats))]),e("b-form-group",{attrs:{label:"張數","label-for":"seat"}},[e("b-form-spinbutton",{attrs:{id:"seat",min:"1",max:t.selected.seats},model:{value:t.seats,callback:function(s){t.seats=s},expression:"seats"}})],1),e("p",{staticClass:"d-inline"},[t._v("總價")]),e("p",{staticClass:"d-inline ml-2",model:{value:t.seats,callback:function(s){t.seats=s},expression:"seats"}},[t._v("$"+t._s(t.seats*t.totalPrice))]),e("div",{staticClass:"d-flex justify-content-end"},[e("b-button",{attrs:{variant:"success",type:"submit"}},[t._v("送出")]),e("b-button",{staticClass:"ml-2",attrs:{type:"reset"}},[t._v("重填")])],1)],1)],1)],1)],1)],1)},i=[],c=(e("d81d"),{name:"tickets",data:function(){return{tickets:{},selected:{},options:[],seats:1,totalPrice:0}},computed:{user:function(){return this.$store.state.user},concertId:function(){return this.$store.state.concertId}},methods:{onSubmit:function(){var t,s,e=this;this.tickets.map((function(a){a._id===e.selected.id&&(s={t_id:a.c_id._id,quantity:e.seats},t={seats:a.seats-e.seats,id:a._id})})),this.axios.post("https://cyb-backstage.herokuapp.com/ticket/bookTicket",s).then((function(s){s.data.success&&e.axios.patch("https://cyb-backstage.herokuapp.com/ticket/"+t.id,{seats:t.seats}).then((function(t){t.data.success&&(e.$swal({icon:"success",title:"成功",text:"訂票成功，請確認 會員中心 > 我的票券"}),e.$router.push({name:"UserCenter"}))}))})).catch((function(t){e.$swal({icon:"error",title:"錯誤",text:t.response.data.message})}))},onReset:function(){this.seats=1}},mounted:function(){var t=this;this.axios.get("https://cyb-backstage.herokuapp.com/ticket/tickets").then((function(s){s.data.success&&(t.tickets=s.data.result,t.tickets.map((function(s){t.options.push({value:{id:s._id,seats:s.seats},text:s.title})})))})).then((function(s){t.tickets.map((function(s){t.concertId===s.c_id._id&&(t.selected={id:s._id,seats:s.seats},t.totalPrice=s.price)}))}))}}),n=c,o=(e("b7fc"),e("2877")),l=Object(o["a"])(n,a,i,!1,null,null,null);s["default"]=l.exports}}]);
//# sourceMappingURL=tickets.f01c61e6.js.map